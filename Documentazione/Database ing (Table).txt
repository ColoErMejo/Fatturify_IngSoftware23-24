package database;

import java.io.File;
import java.sql.Connection;
import java.sql.DatabaseMetaData;
import java.sql.DriverManager;
import java.sql.SQLException;
import java.sql.Statement;

public class DB_NewDBUtente {
	public static String NomeUtente;
	private static String DB_REL_FILE;
	private static String DB_URL;
	
	public DB_NewDBUtente(String NomeUtente)
	{
		this.NomeUtente=NomeUtente;
		this.DB_REL_FILE = "../database/"+NomeUtente+".db3";
		this.DB_URL = "jdbc:sqlite:" + DB_REL_FILE;
	}
	
	public void createDB() throws SQLException
	{
		//System.out.println("debug " + NomeUtente);
		if(new File(DB_REL_FILE).exists())
			System.out.println("db " + NomeUtente +" gia esistente");
		else
		{
			Connection conn = DriverManager.getConnection(DB_URL);
			DatabaseMetaData meta = conn.getMetaData();
			System.out.println("db " + NomeUtente +" creato con successo");
			// funzioni create table
			createTableUtente();
			createTableCantiere();
		}
	}
	
	//CREATE TABLE
		public void createTableUtente()
		{
			try {
				Connection conn = DriverManager.getConnection(DB_URL);
				if (conn != null) {
					Statement stmt = conn.createStatement();
					String sql = "CREATE TABLE UTENTE (" + "NOMEAZIENDA		TEXT," + " NOMEUTENTE		TEXT," + " PASSWORD		 TEXT )";
					stmt.executeUpdate(sql);
					stmt.close();
					conn.close();
					System.out.println("Tabella utente creata");
				}
			} catch (SQLException e) {
				System.out.println(e.getMessage());
			} 
		}
		
		public void createTableCantiere() {
    try {
        Connection conn = DriverManager.getConnection(DB_URL);
        if (conn != null) {
            Statement stmt = conn.createStatement();
            String sql = "CREATE TABLE CANTIERE (" + "ID_CANTIERE      INT PRIMARY KEY," + "NOME_CANTIERE    TEXT," + "INDIRIZZO        TEXT," + "DATA_INIZIO      DATE," +
                    "DATA_FINE        DATE)";
            stmt.executeUpdate(sql);
            stmt.close();
            conn.close();
            System.out.println("Tabella cantiere creata");
        }
    } catch (SQLException e) {
        System.out.println(e.getMessage());
    }
}

public void createTableProdotto() {
    try {
        Connection conn = DriverManager.getConnection(DB_URL);
        if (conn != null) {
            Statement stmt = conn.createStatement();
            String sql = "CREATE TABLE PRODOTTO (" +"CODICE_PRODOTTO  INT PRIMARY KEY," +"NOME_PRODOTTO    TEXT," +"DESCRIZIONE      TEXT," + "PREZZO           DECIMAL(10, 2)," + "Quantit√†    TEXT)";
            stmt.executeUpdate(sql);
            stmt.close();
            conn.close();
            System.out.println("Tabella prodotto creata");
        }
    } catch (SQLException e) {
        System.out.println(e.getMessage());
    }
}

public void createTablePersonale() {
    try {
        Connection conn = DriverManager.getConnection(DB_URL);
        if (conn != null) {
            Statement stmt = conn.createStatement();
            String sql = "CREATE TABLE PERSONALE (" +"ID_PERSONALE     INT PRIMARY KEY," +"NOME             TEXT," +"COGNOME          TEXT," +"RUOLO            TEXT," +"DATA_ASSUNZIONE  DATE)";
            stmt.executeUpdate(sql);
            stmt.close();
            conn.close();
            System.out.println("Tabella personale creata");
        }
    } catch (SQLException e) {
        System.out.println(e.getMessage());
    }
}

public void createTableFatture() {
    try {
        Connection conn = DriverManager.getConnection(DB_URL);
        if (conn != null) {
            Statement stmt = conn.createStatement();
            String sql = "CREATE TABLE FATTURE (" +"NUMERO_FATTURA   INT PRIMARY KEY," + "DATA_EMISSIONE   DATE," + "CLIENTE          TEXT," + "IMPORTO          DECIMAL(10, 2)," +"DESCRIZIONE      TEXT)";
            stmt.executeUpdate(sql);
            stmt.close();
            conn.close();
            System.out.println("Tabella fatture creata");
        }
    } catch (SQLException e) {
        System.out.println(e.getMessage());
    }
}
public void createTableCategorie() {
    try {
        Connection conn = DriverManager.getConnection(DB_URL);
        if (conn != null) {
            Statement stmt = conn.createStatement();
            String sql = "CREATE TABLE CATEGORIE (" +
                    "ID_CATEGORIA     INT PRIMARY KEY," + "NOME_CATEGORIA   TEXT," + "DESCRIZIONE      TEXT," + "NOME_PRODOTTO    TEXT)";
            stmt.executeUpdate(sql);
            stmt.close();
            conn.close();
            System.out.println("Tabella categorie creata");
        }
    } catch (SQLException e) {
        System.out.println(e.getMessage());
    }
}

}
